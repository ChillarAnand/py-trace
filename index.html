<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>index</title>
<meta name="author" content="(Anand Reddy Pandikunta)"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/2.5.0/css/reveal.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/2.5.0/css/theme/simple.css" id="theme"/>

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/reveal.js/2.5.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">

      <div class='footer'>
      <style>
       .reveal .footer {
         position: absolute;
         bottom: 0.5em;
         left: 0.5em;
         font-size: 0.5em;
       }
      </style>
        <span>(c) Anand Reddy Pandikunta 
            (<a href="http://twitter.com/chillaranand">@chillaranand</a>)
        </span>
        <a href="http://www.avilpage.com">http://avilpage.com</a>
      </div>

<div class="slides">



</section>
<section id="sec-0-1" >

<h3>Python Traceback For Humans</h3>


</section>
<section id="sec-0-2" >

<h3>Topics</h3>
<p>
What is traceback?
</p>

<p>
Default traceback &#x2013;&gt; Colored traceback.
</p>

<p>
Things You can do with custom traceback.
</p>

<p>
Traceback - The forgotten debugging tool.
</p>

<p>
Using Conditionals/Exceptions For Better Traceback
</p>



</section>
<section id="sec-0-3" >

<h3>Traceback</h3>
<div class="org-src-container">

<pre  class="src src-python">Traceback (most recent call last):
<span style="background-color: #f2f2f2;"> </span> File <span style="color: #8b2252;">"mail_send.py"</span>, line 25, <span style="color: #a020f0;">in</span> &lt;module&gt;
<span style="background-color: #f2f2f2;"> </span>   send_mail()
<span style="background-color: #f2f2f2;"> </span> File <span style="color: #8b2252;">"mail_send.py"</span>, line 21, <span style="color: #a020f0;">in</span> send_mail
<span style="background-color: #f2f2f2;"> </span>   server.sendmail(fromaddr, toaddrs, msg)
<span style="background-color: #f2f2f2;"> </span> File <span style="color: #8b2252;">"/usr/local/lib/python2.7/smtplib.py"</span>, line 724, <span style="color: #a020f0;">in</span> sendmail
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a020f0;">raise</span> SMTPSenderRefused(code, resp, from_addr)
smtplib.SMTPSenderRefused: (530, <span style="color: #8b2252;">'5.5.1 Authentication Required.'</span>)
</pre>
</div>

<p>
Trigger point
</p>

<p>
Cause
</p>

<p>
Occurred point
</p>


</section>
<section id="sec-0-4" >

<h3>Custom Traceback</h3>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">custom_traceback</span>(<span style="color: #483d8b;">type</span>, value, traceback):
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a020f0;">print</span>(<span style="color: #8b2252;">'successfully completed'</span>)

<span style="color: #a020f0;">import</span> sys
<span style="color: #a0522d;">sys.excepthook</span> = custom_traceback
</pre>
</div>


</section>
<section id="sec-0-5" >

<h3>Mimic Python Traceback</h3>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a020f0;">def</span> <span style="color: #0000ff;">custom_traceback</span>(et, ev, tb):
<span style="background-color: #f2f2f2;"> </span>   traceback.print_exception(et, ev, tb)

<span style="color: #a020f0;">import</span> sys
<span style="color: #a0522d;">sys.excepthook</span> = custom_traceback
</pre>
</div>


</section>
<section id="sec-0-6" >

<h3>Colored traceback</h3>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a020f0;">from</span> pygments <span style="color: #a020f0;">import</span> highlight
<span style="color: #a020f0;">from</span> pygments.formatters <span style="color: #a020f0;">import</span> TerminalFormatter
<span style="color: #a020f0;">from</span> pygments.lexers <span style="color: #a020f0;">import</span> PythonTracebackLexer

<span style="color: #a020f0;">def</span> <span style="color: #0000ff;">custom_traceback</span>(et, ev, tb):
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a0522d;">tb</span> = <span style="color: #8b2252;">""</span>.join(traceback.format_exception(et, ev, tb))
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a020f0;">print</span>(highlight(code=tb, lexer=PythonTracebackLexer(), formatter=TerminalFormatter()))

<span style="color: #a0522d;">sys.excepthook</span> = custom_traceback
</pre>
</div>


</section>
<section id="sec-0-7" >

<h3>General Uses Of Custom Traceback</h3>
<p>
IDE - Hyperlinks in traceback/debugger
</p>

<p>
iPython - Run buggy code without crashing
</p>

<p>
GUI apps - Continue execution even exceptions occur
</p>

<p>
Werkzeug - Interactive debugging
</p>


</section>
<section id="sec-0-8" >

<h3>Traceback as the debugging tool</h3>


</section>
<section id="sec-0-9" >

<h3>The magical print</h3>
<p>
Automatically print the value of objects when an exception occurs
</p>

<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a0522d;">et</span>, <span style="color: #a0522d;">ev</span>, <span style="color: #a0522d;">tb</span> = einfo
<span style="color: #a0522d;">frame_records</span> = inspect.getinnerframes(tb, context)

<span style="color: #a0522d;">frame</span>, <span style="color: #a0522d;">fname</span>, <span style="color: #a0522d;">lnum</span>, <span style="color: #a0522d;">func</span>, <span style="color: #a0522d;">lines</span>, <span style="color: #a0522d;">index</span> = frame_record
<span style="color: #a0522d;">args</span>, <span style="color: #a0522d;">varargs</span>, <span style="color: #a0522d;">varkw</span>, <span style="color: #a0522d;">local_vars</span> = inspect.getargvalues(frame)

<span style="color: #a0522d;">objects</span> = cgitb.scanvars(reader, frame, local_vars)
</pre>
</div>


</section>
<section id="sec-0-10" >

<h3>Normal traceback</h3>
<div class="org-src-container">

<pre  class="src src-python">Traceback (most recent call last):
<span style="background-color: #f2f2f2;"> </span> File <span style="color: #8b2252;">"magical_print.py"</span>, line 9, <span style="color: #a020f0;">in</span> &lt;module&gt;
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a0522d;">total</span> = <span style="color: #483d8b;">sum</span>(num1 + num2 + num3)
<span style="color: #228b22;">TypeError</span>: unsupported operand <span style="color: #483d8b;">type</span>(s) <span style="color: #a020f0;">for</span> +: <span style="color: #8b2252;">'int'</span> <span style="color: #a020f0;">and</span> <span style="color: #8b2252;">'str'</span>
</pre>
</div>

</section>
<section id="sec-0-11" >

<h3>Pretty traceback</h3>
<div class="org-src-container">

<pre  class="src src-python">Pretty Traceback:

File:      /home/anand/talks/ptb/code/magical_print.py
Call:      &lt;module&gt;()
Context:
---------&gt; 9 <span style="color: #a0522d;">total</span> = <span style="color: #483d8b;">sum</span>(num1 + num2 + num3)
Objects:   total <span style="color: #a0522d;">undefined</span>, <span style="color: #a0522d;">num1</span> = <span style="color: #a0522d;">1</span>, <span style="color: #a0522d;">num2</span> = <span style="color: #8b2252;">'2'</span>, <span style="color: #a0522d;">num3</span> = 3

<span style="color: #228b22;">TypeError</span>: unsupported operand <span style="color: #483d8b;">type</span>(s) <span style="color: #a020f0;">for</span> +: <span style="color: #8b2252;">'int'</span> <span style="color: #a020f0;">and</span> <span style="color: #8b2252;">'str'</span>
</pre>
</div>


</section>
<section id="sec-0-12" >

<h3>Filtering frames</h3>
<p>
Most developers are interested in bugs in their code(most of the time)
</p>


<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a0522d;">et</span>, <span style="color: #a0522d;">ev</span>, <span style="color: #a0522d;">tb</span> = einfo
<span style="color: #a0522d;">frame_records</span> = inspect.getinnerframes(tb, context)

<span style="color: #a0522d;">frame</span>, <span style="color: #a0522d;">fname</span>, <span style="color: #a0522d;">lnum</span>, <span style="color: #a0522d;">func</span>, <span style="color: #a0522d;">lines</span>, <span style="color: #a0522d;">index</span> = frame_record
<span style="color: #a020f0;">if</span> project_path <span style="color: #a020f0;">in</span> fname:
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #b22222;"># </span><span style="color: #b22222;">process frame</span>
</pre>
</div>



</section>
<section id="sec-0-13" >

<h3>Django Traceback</h3>
<img src="./images/filter-frames.png" alt="filter-frames.png" />




</section>
<section id="sec-0-14" >

<h3>More context</h3>
<p>
Sometimes looking around might help!
</p>


</section>
<section id="sec-0-15" >

<h3>Look around</h3>
<div class="org-src-container">

<pre  class="src src-python">File:      /home/anand/talks/ptb/code/calc_slice.py
Call:      validate_step(step=<span style="color: #008b8b;">None</span>)
Context:
<span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   8     <span style="color: #a020f0;">if</span> step == 0:
<span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   9         <span style="color: #a020f0;">raise</span> <span style="color: #228b22;">Exception</span>(<span style="color: #8b2252;">"Step cannot be zero."</span>)
---------&gt; 10     <span style="color: #a020f0;">if</span> step &lt; 0:
<span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>  11         reverse = <span style="color: #008b8b;">True</span>
<span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>   <span style="background-color: #f2f2f2;"> </span>  12     <span style="color: #a020f0;">if</span> step <span style="color: #a020f0;">is</span> <span style="color: #008b8b;">None</span>:
</pre>
</div>



</section>
<section id="sec-0-16" >

<h3>Is it worth it?</h3>
<p>
Time spent on debugging.
</p>

<p>
Most common exceptions.
</p>


</section>
<section id="sec-0-17" >

<h3>Exercise</h3>


</section>
<section id="sec-0-18" >

<h3>Using Conditionals/Exceptions For Better Traceback</h3>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a020f0;">try</span>:
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a0522d;">result</span> = num / den
<span style="color: #a020f0;">except</span> <span style="color: #228b22;">ZeroDivisionError</span>:
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a020f0;">print</span>(<span style="color: #8b2252;">'Zero Division'</span>)


<span style="color: #a020f0;">if</span> (den != 0):
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #a0522d;">result</span> = num / den
</pre>
</div>


</section>
<section id="sec-0-19" >

<h3>Exception Chaining</h3>
<div class="org-src-container">

<pre  class="src src-python"><span style="color: #a020f0;">try</span>:
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #b22222;"># </span><span style="color: #b22222;">read PEP 3134</span>
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #b22222;"># </span><span style="color: #b22222;">understand exception chaining</span>
<span style="color: #a020f0;">except</span> LazyToDoThatError:
<span style="background-color: #f2f2f2;"> </span>   <span style="color: #b22222;"># </span><span style="color: #b22222;">start using Python 3!!</span>
</pre>
</div>


</section>
<section id="sec-0-20" >

<h3>Questions?</h3>

</section>

</div>
</div>

<script src="https://cdn.jsdelivr.net/reveal.js/2.5.0/lib/js/head.min.js"></script>
<script src="https://cdn.jsdelivr.net/reveal.js/2.5.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: true,
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/reveal.js/2.5.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/2.5.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
]
});
</script>
</body>
</html>
